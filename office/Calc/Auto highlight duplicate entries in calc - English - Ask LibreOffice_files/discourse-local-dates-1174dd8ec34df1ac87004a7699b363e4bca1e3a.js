define("discourse/plugins/discourse-local-dates/discourse/components/discourse-local-dates-create-form",["exports","discourse-common/utils/decorators","@ember/component","@ember/object","I18n","discourse-common/config/environment","rsvp","discourse/lib/text","discourse-common/lib/debounce","@ember/utils","discourse/lib/load-script","@ember/object/computed","discourse/lib/computed","@ember/runloop","discourse-common/lib/get-owner"],function(e,t,n,a,r,o,i,s,l,c,u,d,m,f,p){"use strict";function h(e,t,n,a,r){var o={};return Object.keys(a).forEach(function(e){o[e]=a[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,a){return a(e,t,n)||n},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=undefined),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var v,y,g,z,b,_,T,w,D,k,P,O,L,S;Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var j=n["default"].extend((v=(0,t.observes)("markup"),y=(0,t["default"])("date","toDate","toTime"),g=(0,t["default"])("computedConfig","isRange"),z=(0,t["default"])("date","time","isRange","options.{format,timezone}"),b=(0,t["default"])("toDate","toTime","isRange","options.{timezone,format}"),_=(0,t["default"])("recurring","timezones","timezone","format"),T=(0,t["default"])("fromConfig.{date}","toConfig.{date}","options.{recurring,timezones,timezone,format}"),w=(0,t["default"])("currentUserTimezone"),D=(0,t["default"])("formats"),k=(0,t["default"])("advancedMode"),P=(0,t["default"])("computedConfig.{from,to,options}","options","isValid","isRange"),O=(0,t["default"])("fromConfig.dateTime"),L=(0,t["default"])("toConfig.dateTime","toSelected"),h(S={timeFormat:"HH:mm:ss",dateFormat:"YYYY-MM-DD",dateTimeFormat:"YYYY-MM-DD HH:mm:ss",date:null,toDate:null,time:null,toTime:null,format:null,formats:null,recurring:null,advancedMode:!1,timezone:null,fromSelected:null,fromFilled:(0,d.notEmpty)("date"),toSelected:null,toFilled:(0,d.notEmpty)("toDate"),init:function(){this._super.apply(this,arguments),this._picker=null,this.setProperties({timezones:[],formats:(this.siteSettings.discourse_local_dates_default_formats||"").split("|").filter(function(e){return e}),timezone:moment.tz.guess(),date:moment().format(this.dateFormat)})},didInsertElement:function(){var e=this;this._super.apply(this,arguments),this._setupPicker().then(function(t){e._picker=t,e.send("focusFrom")})},_renderPreview:function(){(0,l["default"])(this,function(){var e=this,t=this.markup;t&&(0,s.cookAsync)(t).then(function(t){e.set("currentPreview",t),(0,f.schedule)("afterRender",function(){return e.$(".preview .discourse-local-date").applyLocalDates()})})},o.INPUT_DELAY)},isRange:function(e,t,n){return e&&(t||n)},isValid:function(e,t){var n=e.from;if(!e.from.dateTime||!e.from.dateTime.isValid())return!1;if(t){var a=e.to;if(!a.dateTime||!a.dateTime.isValid()||a.dateTime.diff(n.dateTime)<0)return!1}return!0},fromConfig:function(e,t,n){var r,o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},i=!t;r=i?moment.tz(e,o.timezone):moment.tz("".concat(e," ").concat(t),o.timezone),i||(t=r.format(this.timeFormat));var s=o.format;return i&&this.formats.includes(s)&&(s="LL"),a["default"].create({date:r.format(this.dateFormat),time:t,dateTime:r,format:s,range:!!n&&"start"})},toConfig:function(e,t,n){var r,o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},i=!t;t&&!e&&(e=moment().format(this.dateFormat)),r=i?moment.tz(e,o.timezone).endOf("day"):moment.tz("".concat(e," ").concat(t),o.timezone),i||(t=r.format(this.timeFormat));var s=o.format;return i&&this.formats.includes(s)&&(s="LL"),a["default"].create({date:r.format(this.dateFormat),time:t,dateTime:r,format:s,range:!!n&&"end"})},options:function(e,t,n,r){return a["default"].create({recurring:e,timezones:t,timezone:n,format:r})},computedConfig:function(e,t,n){return a["default"].create({from:e,to:t,options:n})},currentUserTimezone:function(){return moment.tz.guess()},allTimezones:function(){return moment.tz.names()},timezoneIsDifferentFromUserTimezone:(0,m.propertyNotEqual)("currentUserTimezone","options.timezone"),formatedCurrentUserTimezone:function(e){return e.replace("_"," ").replace("Etc/","").split("/")},previewedFormats:function(e){return e.map(function(e){return{format:e,preview:moment().format(e)}})},recurringOptions:function(){var e="discourse_local_dates.create.form.recurring";return[{name:r["default"].t("".concat(e,".every_day")),id:"1.days"},{name:r["default"].t("".concat(e,".every_week")),id:"1.weeks"},{name:r["default"].t("".concat(e,".every_two_weeks")),id:"2.weeks"},{name:r["default"].t("".concat(e,".every_month")),id:"1.months"},{name:r["default"].t("".concat(e,".every_two_months")),id:"2.months"},{name:r["default"].t("".concat(e,".every_three_months")),id:"3.months"},{name:r["default"].t("".concat(e,".every_six_months")),id:"6.months"},{name:r["default"].t("".concat(e,".every_year")),id:"1.years"}]},_generateDateMarkup:function(e,t,n,a){var r="";if(n){var o=[e.date,e.time].filter(function(e){return!(0,c.isEmpty)(e)}).join("T"),i=[a.date,a.time].filter(function(e){return!(0,c.isEmpty)(e)}).join("T");r+="[date-range from=".concat(o," to=").concat(i)}else r+="[date=".concat(e.date);return e.time&&!n&&(r+=" time=".concat(e.time)),e.format&&e.format.length&&(r+=' format="'.concat(e.format,'"')),t.timezone&&(r+=' timezone="'.concat(t.timezone,'"')),t.timezones&&t.timezones.length&&(r+=' timezones="'.concat(t.timezones.join("|"),'"')),t.recurring&&!n&&(r+=' recurring="'.concat(t.recurring,'"')),r+="]"},toggleModeBtnLabel:function(e){return e?"discourse_local_dates.create.form.simple_mode":"discourse_local_dates.create.form.advanced_mode"},markup:function(e,t,n,a){var r;return n&&e.from&&(r=e.to&&e.to.range?this._generateDateMarkup(e.from,t,a,e.to):this._generateDateMarkup(e.from,t,a)),r},formattedFrom:function(e){return e.format("LLLL")},formattedTo:function(e,t){var n=t?"&nbsp;":r["default"].t("discourse_local_dates.create.form.until");return e.isValid()?e.format("LLLL"):n},actions:{setTime:function(e){this._setTimeIfValid(e.target.value,"time")},setToTime:function(e){this._setTimeIfValid(e.target.value,"toTime")},eraseToDateTime:function(){this.setProperties({toDate:null,toTime:null}),this._setPickerDate(null)},focusFrom:function(){this.setProperties({fromSelected:!0,toSelected:!1}),this._setPickerDate(this.get("fromConfig.date")),this._setPickerMinDate(null)},focusTo:function(){this.setProperties({toSelected:!0,fromSelected:!1}),this._setPickerDate(this.get("toConfig.date")),this._setPickerMinDate(this.get("fromConfig.date"))},advancedMode:function(){this.toggleProperty("advancedMode")},save:function(){var e=this.markup;e&&(this._closeModal(),this.insertDate(e))},cancel:function(){this._closeModal()}},_setTimeIfValid:function(e,t){(0,c.isEmpty)(e)?this.set(t,null):/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/.test(e)&&this.set(t,e)},_setupPicker:function(){var e=this;return new i.Promise(function(t){(0,u["default"])("/javascripts/pikaday.js").then(function(){var n={field:e.$(".fake-input")[0],container:e.$("#picker-container-".concat(e.elementId))[0],bound:!1,format:"YYYY-MM-DD",reposition:!1,firstDay:1,setDefaultDate:!0,keyboardInput:!1,i18n:{previousMonth:r["default"].t("dates.previous_month"),nextMonth:r["default"].t("dates.next_month"),months:moment.months(),weekdays:moment.weekdays(),weekdaysShort:moment.weekdaysMin()},onSelect:function(t){var n=moment(t).format("YYYY-MM-DD");e.fromSelected&&e.set("date",n),e.toSelected&&e.set("toDate",n)}};t(new Pikaday(n))})})},_setPickerMinDate:function(e){var t=this;e&&!moment(e,this.dateFormat).isValid()&&(e=null),(0,f.schedule)("afterRender",function(){t._picker.setMinDate(moment(e,t.dateFormat).toDate())})},_setPickerDate:function(e){var t=this;e&&!moment(e,this.dateFormat).isValid()&&(e=null),(0,f.schedule)("afterRender",function(){t._picker.setDate(moment.utc(e),!0)})},_closeModal:function(){(0,p.getOwner)(this).lookup("controller:composer").send("closeModal")}},"_renderPreview",[v],Object.getOwnPropertyDescriptor(S,"_renderPreview"),S),h(S,"isRange",[y],Object.getOwnPropertyDescriptor(S,"isRange"),S),h(S,"isValid",[g],Object.getOwnPropertyDescriptor(S,"isValid"),S),h(S,"fromConfig",[z],Object.getOwnPropertyDescriptor(S,"fromConfig"),S),h(S,"toConfig",[b],Object.getOwnPropertyDescriptor(S,"toConfig"),S),h(S,"options",[_],Object.getOwnPropertyDescriptor(S,"options"),S),h(S,"computedConfig",[T],Object.getOwnPropertyDescriptor(S,"computedConfig"),S),h(S,"currentUserTimezone",[t["default"]],Object.getOwnPropertyDescriptor(S,"currentUserTimezone"),S),h(S,"allTimezones",[t["default"]],Object.getOwnPropertyDescriptor(S,"allTimezones"),S),h(S,"formatedCurrentUserTimezone",[w],Object.getOwnPropertyDescriptor(S,"formatedCurrentUserTimezone"),S),h(S,"previewedFormats",[D],Object.getOwnPropertyDescriptor(S,"previewedFormats"),S),h(S,"recurringOptions",[t["default"]],Object.getOwnPropertyDescriptor(S,"recurringOptions"),S),h(S,"toggleModeBtnLabel",[k],Object.getOwnPropertyDescriptor(S,"toggleModeBtnLabel"),S),h(S,"markup",[P],Object.getOwnPropertyDescriptor(S,"markup"),S),h(S,"formattedFrom",[O],Object.getOwnPropertyDescriptor(S,"formattedFrom"),S),h(S,"formattedTo",[L],Object.getOwnPropertyDescriptor(S,"formattedTo"),S),S));e["default"]=j}),define("discourse/plugins/discourse-local-dates/discourse/controllers/discourse-local-dates-create-modal",["exports","@ember/controller","discourse/mixins/modal-functionality","@ember/runloop"],function(e,t,n,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var r=t["default"].extend(n["default"],{onShow:function(){(0,a.schedule)("afterRender",function(){var e=document.getElementById("from-date-time");e&&e.focus()})},onClose:function(){(0,a.schedule)("afterRender",function(){var e=document.querySelector(".d-editor-button-bar .local-dates.btn");e&&e.focus()})}});e["default"]=r}),Ember.TEMPLATES["javascripts/components/discourse-local-dates-create-form"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["previewedFormat"],"statements":[[4,"d-modal-body",null,[["title","class","style"],["discourse_local_dates.title","discourse-local-dates-create-modal","overflow: auto"]],{"statements":[[0,"\\n  "],[7,"div",true],[10,"class","form"],[8],[0,"\\n"],[4,"if",[[24,["isValid"]]],null,{"statements":[[4,"if",[[24,["timezoneIsDifferentFromUserTimezone"]]],null,{"statements":[[0,"        "],[7,"div",true],[10,"class","preview alert alert-info"],[8],[0,"\\n          "],[7,"b",true],[8],[1,[22,"formatedCurrentUserTimezone"],false],[0," "],[9],[1,[22,"currentPreview"],false],[0,"\\n        "],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},{"statements":[[0,"      "],[7,"div",true],[10,"class","validation-error alert alert-error"],[8],[0,"\\n        "],[1,[28,"i18n",["discourse_local_dates.create.form.invalid_date"],null],false],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]}],[0,"\\n    "],[1,[22,"computeDate"],false],[0,"\\n\\n    "],[7,"div",true],[10,"class","date-time-configuration"],[8],[0,"\\n      "],[7,"div",true],[10,"class","inputs-panel"],[8],[0,"\\n        "],[7,"div",true],[11,"class",[29,["date-time-control from ",[28,"if",[[24,["fromSelected"]],"is-selected"],null]," ",[28,"if",[[24,["fromFilled"]],"is-filled"],null]]]],[8],[0,"\\n          "],[1,[28,"d-icon",["calendar-alt"],null],false],[0,"\\n          "],[1,[28,"d-button",null,[["id","action","translatedLabel","class"],["from-date-time",[28,"action",[[23,0,[]],"focusFrom"],null],[24,["formattedFrom"]],"date-time"]]],false],[0,"\\n        "],[9],[0,"\\n\\n        "],[7,"div",true],[11,"class",[29,["date-time-control to ",[28,"if",[[24,["toSelected"]],"is-selected"],null]," ",[28,"if",[[24,["toFilled"]],"is-filled"],null]]]],[8],[0,"\\n          "],[1,[28,"d-icon",["calendar-alt"],null],false],[0,"\\n          "],[1,[28,"d-button",null,[["action","translatedLabel","class"],[[28,"action",[[23,0,[]],"focusTo"],null],[24,["formattedTo"]],"date-time"]]],false],[0,"\\n"],[4,"if",[[24,["toFilled"]]],null,{"statements":[[0,"            "],[1,[28,"d-button",null,[["icon","action","class"],["times",[28,"action",[[23,0,[]],"eraseToDateTime"],null],"delete-to-date"]]],false],[0,"\\n"]],"parameters":[]},null],[0,"        "],[9],[0,"\\n\\n"],[4,"unless",[[24,["site","mobileView"]]],null,{"statements":[[0,"          "],[1,[28,"timezone-input",null,[["options","value","onChange"],[[28,"hash",null,[["icon"],["globe"]]],[24,["timezone"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["timezone"]]],null]],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"      "],[9],[0,"\\n\\n      "],[7,"div",true],[10,"class","picker-panel"],[8],[0,"\\n        "],[1,[28,"input",null,[["class"],["fake-input"]]],false],[0,"\\n        "],[7,"div",true],[10,"class","date-picker"],[11,"id",[29,["picker-container-",[22,"elementId"]]]],[8],[9],[0,"\\n\\n"],[4,"if",[[24,["fromSelected"]]],null,{"statements":[[0,"          "],[7,"div",true],[10,"class","time-pickers"],[8],[0,"\\n            "],[1,[28,"d-icon",["far-clock"],null],false],[0,"\\n            "],[1,[28,"input",null,[["maxlength","placeholder","input","type","value","class"],[5,"hh:mm",[28,"action",[[23,0,[]],"setTime"],null],"time",[24,["time"]],"time-picker"]]],false],[0,"\\n          "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"if",[[24,["toSelected"]]],null,{"statements":[[4,"if",[[24,["toDate"]]],null,{"statements":[[0,"            "],[7,"div",true],[10,"class","time-pickers"],[8],[0,"\\n              "],[1,[28,"d-icon",["far-clock"],null],false],[0,"\\n              "],[1,[28,"input",null,[["maxlength","placeholder","input","type","value","class"],[5,"hh:mm",[28,"action",[[23,0,[]],"setToTime"],null],"time",[24,["toTime"]],"time-picker"]]],false],[0,"\\n            "],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"      "],[9],[0,"\\n\\n"],[4,"if",[[24,["site","mobileView"]]],null,{"statements":[[0,"        "],[1,[28,"timezone-input",null,[["value","options","onChange"],[[24,["timezone"]],[28,"hash",null,[["icon"],["globe"]]],[28,"action",[[23,0,[]],[28,"mut",[[24,["timezone"]]],null]],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"    "],[9],[0,"\\n\\n"],[4,"if",[[24,["advancedMode"]]],null,{"statements":[[0,"      "],[7,"div",true],[10,"class","advanced-options"],[8],[0,"\\n"],[4,"unless",[[24,["isRange"]]],null,{"statements":[[0,"          "],[7,"div",true],[10,"class","control-group recurrence"],[8],[0,"\\n            "],[7,"label",true],[10,"class","control-label"],[8],[0,"\\n              "],[1,[28,"i18n",["discourse_local_dates.create.form.recurring_title"],null],false],[0,"\\n            "],[9],[0,"\\n            "],[7,"p",true],[8],[1,[28,"html-safe",[[28,"i18n",["discourse_local_dates.create.form.recurring_description"],null]],null],false],[9],[0,"\\n            "],[7,"div",true],[10,"class","controls"],[8],[0,"\\n              "],[1,[28,"combo-box",null,[["content","class","value","onChange","none"],[[24,["recurringOptions"]],"recurrence-input",[24,["recurring"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["recurring"]]],null]],null],"discourse_local_dates.create.form.recurring_none"]]],false],[0,"\\n            "],[9],[0,"\\n          "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n        "],[7,"div",true],[10,"class","control-group format"],[8],[0,"\\n          "],[7,"label",true],[8],[1,[28,"i18n",["discourse_local_dates.create.form.format_title"],null],false],[9],[0,"\\n          "],[7,"p",true],[8],[0,"\\n            "],[1,[28,"i18n",["discourse_local_dates.create.form.format_description"],null],false],[0,"\\n            "],[7,"a",true],[10,"target","_blank"],[10,"href","https://momentjs.com/docs/#/parsing/string-format/"],[10,"rel","noopener noreferrer"],[8],[0,"\\n              "],[1,[28,"d-icon",["question-circle"],null],false],[0,"\\n            "],[9],[0,"\\n          "],[9],[0,"\\n          "],[7,"div",true],[10,"class","controls"],[8],[0,"\\n            "],[1,[28,"text-field",null,[["value","class"],[[24,["format"]],"format-input"]]],false],[0,"\\n          "],[9],[0,"\\n        "],[9],[0,"\\n        "],[7,"div",true],[10,"class","control-group"],[8],[0,"\\n          "],[7,"ul",true],[10,"class","formats"],[8],[0,"\\n"],[4,"each",[[24,["previewedFormats"]]],null,{"statements":[[0,"              "],[7,"li",true],[10,"class","format"],[8],[0,"\\n                "],[7,"a",false],[12,"class","moment-format"],[12,"href",""],[3,"action",[[23,0,[]],[28,"mut",[[24,["format"]]],null],[23,1,["format"]]]],[8],[0,"\\n                  "],[1,[23,1,["format"]],false],[0,"\\n                "],[9],[0,"\\n                "],[7,"span",true],[10,"class","previewed-format"],[8],[0,"\\n                  "],[1,[23,1,["preview"]],false],[0,"\\n                "],[9],[0,"\\n              "],[9],[0,"\\n"]],"parameters":[1]},null],[0,"          "],[9],[0,"\\n        "],[9],[0,"\\n\\n        "],[7,"div",true],[10,"class","control-group timezones"],[8],[0,"\\n          "],[7,"label",true],[8],[1,[28,"i18n",["discourse_local_dates.create.form.timezones_title"],null],false],[9],[0,"\\n          "],[7,"p",true],[8],[1,[28,"i18n",["discourse_local_dates.create.form.timezones_description"],null],false],[9],[0,"\\n          "],[7,"div",true],[10,"class","controls"],[8],[0,"\\n            "],[1,[28,"multi-select",null,[["valueProperty","nameProperty","class","allowAny","maximum","content","value"],[null,null,"timezones-input",false,5,[24,["allTimezones"]],[24,["timezones"]]]]],false],[0,"\\n          "],[9],[0,"\\n        "],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer discourse-local-dates-create-modal-footer"],[8],[0,"\\n"],[4,"if",[[24,["isValid"]]],null,{"statements":[[0,"    "],[1,[28,"d-button",null,[["class","action","label"],["btn-primary",[28,"action",[[23,0,[]],"save"],null],"discourse_local_dates.create.form.insert"]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n  "],[7,"a",false],[12,"class","cancel-action"],[12,"href",""],[3,"action",[[23,0,[]],"cancel"]],[8],[0,"\\n    "],[1,[28,"i18n",["cancel"],null],false],[0,"\\n  "],[9],[0,"\\n\\n  "],[1,[28,"d-button",null,[["class","action","icon","label"],["btn-default advanced-mode-btn",[28,"action",[[23,0,[]],"advancedMode"],null],"cog",[24,["toggleModeBtnLabel"]]]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/discourse-local-dates-create-form"}}),Ember.TEMPLATES["javascripts/modal/discourse-local-dates-create-modal"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"discourse-local-dates-create-form",null,[["config","insertDate"],[[24,["config"]],[24,["insertDate"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/discourse-local-dates-create-modal"}}),define("discourse/plugins/discourse-local-dates/initializers/discourse-local-dates",["exports","discourse-common/lib/deprecated","discourse-common/lib/get-owner","discourse/lib/d-popover","../lib/local-date-builder","discourse/lib/plugin-api","discourse/lib/show-modal","discourse/lib/download-calendar","discourse-common/lib/icon-library","I18n"],function(e,t,n,a,r,o,i,s,l,c){"use strict";function u(e,t){return h(e)||p(e,t)||m(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function p(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=undefined;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{a||null==s["return"]||s["return"]()}finally{if(r)throw o}}return n}}function h(e){if(Array.isArray(e))return e}function v(e,t){if(t.discourse_local_dates_enabled){var n=moment.tz.guess();e.forEach(function(e){var a,o=y(e,t),i=new r["default"](o,n).build();e.innerText="",e.insertAdjacentHTML("beforeend",'\n        <svg class="fa d-icon d-icon-globe-americas svg-icon" xmlns="http://www.w3.org/2000/svg">\n          <use href="#globe-americas"></use>\n        </svg>\n        <span class="relative-time">'.concat(i.formated,"</span>\n      ")),e.setAttribute("aria-label",i.textPreview);var s=["cooked-date"];i.pastEvent&&s.push("past"),(a=e.classList).add.apply(a,s)})}}function y(e,t){var n={},a=e.dataset;return 2===g(e).length&&(n.duration=w(e)),n.time=a.time,n.date=a.date,n.recurring=a.recurring,n.timezones=(a.timezones||t.discourse_local_dates_default_timezones||"Etc/UTC").split("|").filter(Boolean),n.timezone=a.timezone,n.calendar="on"===(a.calendar||"on"),n.displayedTimezone=a.displayedTimezone,n.format=a.format||(n.time?"LLL":"LL"),n.countdown=a.countdown,n}function g(e){return e.parentElement?"true"!==e.dataset.range&&2!==e.parentElement.children.length?[e]:Array.from(e.parentElement.children).filter(function(e){return e.dataset.date}):[]}function z(e){var t=e.container.lookup("site-settings:main"),n=e.container.lookup("service:chat"),a=c["default"].t("discourse_local_dates.default_title",{site_name:t.title});n&&(n.addToolbarButton({title:"discourse_local_dates.title",id:"local-dates",icon:"calendar-alt",action:"insertDiscourseLocalDate"}),e.modifyClass("component:chat-composer",{pluginId:"discourse-local-dates",actions:{insertDiscourseLocalDate:function(){var e=this.addText.bind(this);(0,i["default"])("discourse-local-dates-create-modal").setProperties({insertDate:e})}}})),e.decorateCookedElement(function(e,n){var r,o,i=e.querySelectorAll(".discourse-local-date");v(i,t);var s=null==n?void 0:null===(r=n.getModel())||void 0===r?void 0:null===(o=r.topic)||void 0===o?void 0:o.title;i.forEach(function(e){e.dataset.title=e.dataset.title||s||a})},{id:"discourse-local-date"}),e.onToolbarCreate(function(e){e.addButton({title:"discourse_local_dates.title",id:"local-dates",group:"extras",icon:"calendar-alt",sendAction:function(t){return e.context.send("insertDiscourseLocalDate",t)}})}),e.modifyClass("component:d-editor",{pluginId:"discourse-local-dates",actions:{insertDiscourseLocalDate:function(e){(0,i["default"])("discourse-local-dates-create-modal").setProperties({insertDate:function(t){e.addText(t)}})}}})}function b(e,t){var n=y(e,t),a=new r["default"](n,moment.tz.guess()).build().previews.map(function(e){var t=document.createElement("div");t.classList.add("preview"),e.current&&t.classList.add("current");var n=document.createElement("span");n.classList.add("timezone"),n.innerText=e.timezone,t.appendChild(n);var a=document.createElement("span");return a.classList.add("date-time"),a.innerHTML=e.formated,t.appendChild(a),t}),o=document.createElement("div");o.classList.add("locale-dates-previews"),a.forEach(function(e){return o.appendChild(e)});var i=T(e);return i&&o.appendChild(i),o.outerHTML}function _(e,t){var n,a;return n=moment.tz("".concat(e.date," ").concat(e.time||"").trim(),e.timezone),t&&(a=moment.tz("".concat(t.date," ").concat(t.time||"").trim(),t.timezone)),[n,a]}function T(e){var t=u(g(e).map(function(e){return e.dataset}),2),n=t[0],a=t[1],r=u(_(n,a),2),o=r[0],i=r[1];if(o<moment().tz(n.timezone))return!1;var s=document.createElement("div");return s.classList.add("download-calendar"),s.innerHTML="".concat((0,l.renderIcon)("string","file")," ").concat(c["default"].t("download_calendar.add_to_calendar")),s.setAttribute("data-starts-at",o.toISOString()),a&&s.setAttribute("data-ends-at",i.toISOString()),n.time||a||s.setAttribute("data-ends-at",o.add(24,"hours").toISOString()),s.setAttribute("data-title",n.title),s}function w(e){var t=u(g(e).map(function(e){return e.dataset}),2),n=t[0],a=t[1],r=moment("".concat(n.date," ").concat(n.time||"").trim()),o=moment("".concat(a.date," ").concat(a.time||"").trim()).diff(r,"minutes");return e.dataset===n?o:-o}Object.defineProperty(e,"__esModule",{value:!0}),e.applyLocalDates=v,e["default"]=void 0;var D={name:"discourse-local-dates",showDatePopover:function(e){var t,r,o,i,l=(0,n.getOwner)(this);if(!l.isDestroyed&&!l.isDestroying){var c=l.lookup("site-settings:main");if(null==e?void 0:null===(t=e.target)||void 0===t?void 0:null===(r=t.classList)||void 0===r?void 0:r.contains("discourse-local-date"))$(document.getElementById("d-popover"))[0]?(0,a.hidePopover)(e):(0,a.showPopover)(e,{htmlContent:b(e.target,c)});else if(null==e?void 0:null===(o=e.target)||void 0===o?void 0:null===(i=o.classList)||void 0===i?void 0:i.contains("download-calendar")){var u=e.target.dataset;(0,a.hidePopover)(e),(0,s.downloadCalendar)(u.title,[{startsAt:u.startsAt,endsAt:u.endsAt}])}else(0,a.hidePopover)(e)}},hideDatePopover:function(e){var t,n;(null==e?void 0:null===(t=e.target)||void 0===t?void 0:null===(n=t.classList)||void 0===n?void 0:n.contains("discourse-local-date"))&&(0,a.hidePopover)(e)},initialize:function(e){e.lookup("router:main").on("routeWillChange",a.hidePopover),window.addEventListener("click",this.showDatePopover);var n=e.lookup("site-settings:main");n.discourse_local_dates_enabled&&($.fn.applyLocalDates=function(){return(0,t["default"])("`$.applyLocalDates()` is deprecated, import and use `applyLocalDates()` instead."),v(this.toArray(),n)},(0,o.withPluginApi)("0.8.8",z))},teardown:function(){window.removeEventListener("click",this.showDatePopover)}};e["default"]=D}),define("discourse/plugins/discourse-local-dates/lib/date-with-zone-helper",["exports","@ember/object"],function(e,t){"use strict";function n(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function a(e,t){return l(e)||s(e,t)||o(e,t)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function s(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=undefined;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{a||null==s["return"]||s["return"]()}finally{if(r)throw o}}return n}}function l(e){if(Array.isArray(e))return e}function c(e,t){if(!n(e,t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var m=function(){function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};c(this,e),this.timezone=n.timezone||"UTC",this.localTimezone=n.localTimezone||moment.tz.guess(),this.datetime=moment.tz((0,t.getProperties)(n,["year","month","day","hour","minute","second"]),this.timezone)}return d(e,[{key:"isDST",value:function(){return this.datetime.tz(this.localTimezone).isDST()}},{key:"unitRepetitionsBetweenDates",value:function(e,t){var n=a(e.split("."),2),r=n[0],o=n[1],i=Math.abs(this.datetime.diff(t,o,!0)),s=i/r%1;return Math.trunc(i/r)*parseInt(r,10)+(s>0?parseInt(r,10):0)}},{key:"add",value:function(e,t){return this._fromDatetime(this.datetime.clone().add(e,t),this.timezone,this.localTimezone)}},{key:"subtract",value:function(e,t){return this._fromDatetime(this.datetime.clone().subtract(e,t),this.timezone,this.localTimezone)}},{key:"datetimeWithZone",value:function(e){return this.datetime.clone().tz(e)}},{key:"format",value:function(e){return e?this.datetime.tz(this.localTimezone).format(e):this.datetime.tz(this.localTimezone).toISOString(!0)}},{key:"_fromDatetime",value:function(t,n,a){return e.fromDatetime(t,n,a)}}],[{key:"fromDatetime",value:function(t,n,a){return new e({year:t.year(),month:t.month(),day:t.date(),hour:t.hour(),minute:t.minute(),second:t.second(),timezone:n,localTimezone:a})}}]),e}();e["default"]=m}),define("discourse/plugins/discourse-local-dates/lib/discourse-markdown/discourse-local-dates",["exports","pretty-text/engines/discourse-markdown/bbcode-block"],function(e,t){"use strict";function n(e,t){return s(e)||i(e,t)||r(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function i(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=undefined;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{a||null==s["return"]||s["return"]()}finally{if(r)throw o}}return n}}function s(e){if(Array.isArray(e))return e}function l(e,t,n){var a=new t.Token("span_open","span",1);if(a.attrs=[["data-date",t.md.utils.escapeHtml(n.date)]],n.date.match(/\d{4}-\d{2}-\d{2}/))if(!n.time||n.time.match(/\d{2}:\d{2}(?::\d{2})?/)){var r=n.date;if(n.time&&(a.attrs.push(["data-time",t.md.utils.escapeHtml(n.time)]),r="".concat(r," ").concat(n.time)),moment(r).isValid()){if(a.attrs.push(["class","discourse-local-date"]),n.format&&a.attrs.push(["data-format",t.md.utils.escapeHtml(n.format)]),n.countdown&&a.attrs.push(["data-countdown",t.md.utils.escapeHtml(n.countdown)]),n.calendar&&a.attrs.push(["data-calendar",t.md.utils.escapeHtml(n.calendar)]),n.range&&a.attrs.push(["data-range",!0]),n.displayedTimezone&&h.includes(n.displayedTimezone)&&a.attrs.push(["data-displayed-timezone",t.md.utils.escapeHtml(n.displayedTimezone)]),n.timezones){var o=n.timezones.split("|").filter(function(e){return h.includes(e)});a.attrs.push(["data-timezones",t.md.utils.escapeHtml(o.join("|"))])}n.timezone&&h.includes(n.timezone)?(a.attrs.push(["data-timezone",t.md.utils.escapeHtml(n.timezone)]),r=moment.tz(r,n.timezone)):r=moment.utc(r),n.recurring&&a.attrs.push(["data-recurring",t.md.utils.escapeHtml(n.recurring)]),e.push(a);var i=r.tz("Etc/UTC").format(t.md.options.discourse.datesEmailFormat||moment.defaultFormat);a.attrs.push(["data-email-preview","".concat(i," UTC")]),f(e,t,r.utc().format(n.format))}else f(e,t,moment.invalid().format())}else f(e,t,moment.invalid().format());else f(e,t,moment.invalid().format())}function c(){return{date:null,time:null,timezone:null,format:null,timezones:null,displayedTimezone:null,countdown:null,range:!1}}function u(e){var n=e.replace(/\u2018|\u2019|\u201e|\u201c|\xab|\xbb|\u201d/g,'"');return(0,t.parseBBCodeTag)("[date date"+n+"]",0,n.length+12)}function d(e,t,n){var a=c(),r=u(t[1]);a.date=r.attrs.date,a.format=r.attrs.format,a.calendar=r.attrs.calendar,a.time=r.attrs.time,a.timezone=(r.attrs.timezone||"").trim(),a.recurring=r.attrs.recurring,a.timezones=r.attrs.timezones,a.displayedTimezone=r.attrs.displayedTimezone,a.countdown=r.attrs.countdown,l(e,n,a)}function m(e,t,a){var r,o,i=c(),s=u(t[1]);if(i.format=s.attrs.format,i.calendar=s.attrs.calendar,i.timezone=(s.attrs.timezone||"").trim(),i.recurring=s.attrs.recurring,i.timezones=s.attrs.timezones,i.displayedTimezone=s.attrs.displayedTimezone,i.countdown=s.attrs.countdown,i.range=s.attrs.from&&s.attrs.to,s.attrs.from){var d=n(s.attrs.from.split("T"),2);r=d[0],o=d[1],i.date=r,i.time=o,l(e,a,i)}if(i.range&&f(e,a,"\u2192"),s.attrs.to){var m=n(s.attrs.to.split("T"),2);r=m[0],o=m[1],i.date=r,i.time=o,l(e,a,i)}}function f(e,t,n){var a;(a=new t.Token("text","",0)).content=n,e.push(a),a=new t.Token("span_close","span",-1),e.push(a)}function p(e){
e.allowList(["span.discourse-local-date","span[aria-label]","span[data-date]","span[data-time]","span[data-format]","span[data-countdown]","span[data-calendar]","span[data-displayed-timezone]","span[data-timezone]","span[data-timezones]","span[data-recurring]","span[data-email-preview]"]),e.registerOptions(function(e,t){e.datesEmailFormat=t.discourse_local_dates_email_format,e.features["discourse-local-dates"]=!!t.discourse_local_dates_enabled}),e.registerPlugin(function(e){var t={matcher:/\[date(=.+?)\]/,onMatch:d};e.core.textPostProcess.ruler.push("discourse-local-dates",t)}),e.registerPlugin(function(e){var t={matcher:/\[date-range(.+?)\]/,onMatch:m};e.core.textPostProcess.ruler.push("discourse-local-dates",t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=p;var h=moment.tz.names()}),define("discourse/plugins/discourse-local-dates/lib/local-date-builder",["exports","./date-with-zone-helper","I18n","discourse-common/lib/icon-library"],function(e,t,n,a){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function o(e,t){return u(e)||c(e,t)||s(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function c(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=undefined;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{a||null==s["return"]||s["return"]()}finally{if(r)throw o}}return n}}function u(e){if(Array.isArray(e))return e}function d(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var p="LLL",h="LL",v="LLLL",y="h:mm A",g="dddd",z="\u2192",b="clock",_=1,T=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=arguments.length>1?arguments[1]:undefined;d(this,e),this.time=t.time,this.date=t.date,this.recurring=t.recurring,this.timezones=Array.from(new Set((t.timezones||[]).filter(Boolean))),this.timezone=t.timezone||"UTC",this.calendar="undefined"==typeof t.calendar||t.calendar,this.displayedTimezone=t.displayedTimezone,this.format=t.format||(this.time?p:h),this.countdown=t.countdown,this.duration=t.duration,this.localTimezone=n}return f(e,[{key:"build",value:function(){var e,n=o(this.date.split("-").map(function(e){return parseInt(e,10)}),3),a=n[0],r=n[1],i=n[2],s=o((this.time||"").split(":").map(function(e){return e?parseInt(e,10):undefined}),3),l=s[0],c=s[1],u=s[2];e=this.time?this.displayedTimezone||this.localTimezone:this.displayedTimezone||this.timezone||this.localTimezone;var d=new t["default"]({year:a,month:r?r-1:null,day:i,hour:l,minute:c,second:u,timezone:this.timezone,localTimezone:this.localTimezone});if(this.recurring&&moment().isAfter(d.datetime)){var m=this.recurring.split(".")[1],f=d.unitRepetitionsBetweenDates(this.recurring,moment.tz(this.localTimezone));d=d.add(f,m)}var p=this._generatePreviews(d,e);return{pastEvent:!this.recurring&&moment.tz(this.localTimezone).isAfter(d.datetime),formated:this._applyFormatting(d,e),previews:p,textPreview:this._generateTextPreviews(p)}}},{key:"_generateTextPreviews",value:function(e){var t=this;return e.map(function(e){var n=t._zoneWithoutPrefix(e.timezone);return"".concat(n," ").concat(e.formated)}).join(", ")}},{key:"_generatePreviews",value:function(e,n){var a=this,r=[],o=this.timezones.filter(function(e){return!a._isEqualZones(e,a.localTimezone)});return r.push({timezone:this._zoneWithoutPrefix(this.localTimezone),current:!0,formated:this._createDateTimeRange(t["default"].fromDatetime(e.datetime,e.timezone,this.localTimezone),this.time,this.duration)}),!this.timezone||n!==this.localTimezone||this.timezone===n||this._isEqualZones(n,this.timezone)||this.timezones.any(function(e){return a._isEqualZones(e,a.timezone)})||o.unshift(this.timezone),o.forEach(function(o){a._isEqualZones(o,n)||(a._isEqualZones(o,a.localTimezone)&&(o=a.localTimezone),r.push({timezone:a._zoneWithoutPrefix(o),formated:a._createDateTimeRange(t["default"].fromDatetime(e.datetime,e.timezone,o),a.time,a.duration)}))}),r.uniqBy("timezone")}},{key:"_isEqualZones",value:function(e,t){return!!(!e&&!t||e&&t)&&(!(!e.includes(t)&&!t.includes(e))||moment.tz(e).utcOffset()===moment.tz(t).utcOffset())}},{key:"_createDateTimeRange",value:function(e,t,n){var a=o(this._calculateDatesForRange(e,t,n),2),r=a[0],i=a[1],s=[r.format("".concat(g,", ").concat(h)),this._optionalTimeIcon(r,i),r.format(y)];return i&&(s=s.concat([z,i.format(this._endDateFormat(r,i))])),s.filter(Boolean).join(" ")}},{key:"_shortFormat",value:function(e,t){return t.datetime.diff(e.datetime,"days")<_}},{key:"_optionalTimeIcon",value:function(e,t){if(!t||this._shortFormat(e,t))return"<br />".concat((0,a.renderIcon)("string",b))}},{key:"_endDateFormat",value:function(e,t){return this._shortFormat(e,t)?y:v}},{key:"_calculateDatesForRange",value:function(e,t,n){if(t&&!n)return[e];var a=[e,n?e.add(n,"minutes"):e.add(24,"hours")];return n<0?a.reverse():a}},{key:"_applyFormatting",value:function(e,t){if(this.countdown){var a=moment.tz(this.localTimezone).diff(e.datetime);return a<0?moment.duration(a).humanize():n["default"].t("discourse_local_dates.relative_dates.countdown.passed")}var r=this._isEqualZones(t,this.localTimezone);if(this.calendar&&(moment.tz(this.localTimezone).isBetween(e.subtract(2,"day").datetime,e.add(1,"day").datetime.endOf("day"))&&r)){var o=e.datetimeWithZone(this.localTimezone);return 0===o.hours()&&0===o.minutes()?o.format("dddd"):o.calendar(moment.tz(e.timezone),this._calendarFormats(this.time?this.time:null))}return r?e.format(this.format):this._formatWithZone(e,t,this.format)}},{key:"_calendarFormats",value:function(e){return{sameDay:this._translateCalendarKey(e,"today"),nextDay:this._translateCalendarKey(e,"tomorrow"),lastDay:this._translateCalendarKey(e,"yesterday"),sameElse:"L"}}},{key:"_translateCalendarKey",value:function(e,t){var a=n["default"].t("discourse_local_dates.relative_dates.".concat(t),{time:"LT"});return e?a.split("LT").map(function(e){return"[".concat(e,"]")}).join("LT"):"[".concat(a.replace(" LT",""),"]")}},{key:"_formatTimezone",value:function(e){return e.replace("_"," ").replace("Etc/","").split("/")}},{key:"_zoneWithoutPrefix",value:function(e){var t=o(this._formatTimezone(e),2),n=t[0];return t[1]||n}},{key:"_formatWithZone",value:function(e,t,n){var a=e.datetimeWithZone(t).format(n);return"".concat(a," (").concat(this._zoneWithoutPrefix(t),")")}}]),e}();e["default"]=T});
//# sourceMappingURL=/assets/plugins/discourse-local-dates-1174dd8ec34df1ac87004a7699b363e4bca1e3acae8e1bf5133051ab4956fea5.js.map