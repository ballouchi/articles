define("discourse/plugins/discourse-presence/discourse/components/composer-presence-display",["exports","discourse-common/utils/decorators","@ember/object/computed","@ember/component","@ember/service"],function(e,n,t,r,s){"use strict";function i(e,n,t,r,s){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,r){return r(e,n,t)||t},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=undefined),void 0===i.initializer&&(Object.defineProperty(e,n,i),i=null),i}var l,a,o,c,u,p,d,h,f,m;Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var y=r["default"].extend((l=(0,n["default"])("model.replyingToTopic","model.editingPost","model.whisper","model.composerOpened"),a=(0,n["default"])("model.topic.id","isReply","isWhisper"),o=(0,n["default"])("model.topic.id","isReply","isWhisper"),c=(0,n["default"])("isEdit","model.post.id"),u=(0,n.observes)("replyChannelName","whisperChannelName","editChannelName"),p=(0,n["default"])("isReply","replyingUsers.[]","editingUsers.[]"),d=(0,n.on)("didInsertElement"),h=(0,n.observes)("model.reply","state","model.post.id","model.topic.id"),f=(0,n.on)("willDestroyElement"),i(m={tagName:"",presence:(0,s.inject)(),composerPresenceManager:(0,s.inject)(),state:function(e,n,t,r){if(r)return n?"edit":t?"whisper":e?"reply":void 0},isReply:(0,t.equal)("state","reply"),isEdit:(0,t.equal)("state","edit"),isWhisper:(0,t.equal)("state","whisper"),replyChannelName:function(e,n,t){if(e&&(n||t))return"/discourse-presence/reply/".concat(e)},whisperChannelName:function(e,n,t){if(e&&this.currentUser.staff&&(n||t))return"/discourse-presence/whisper/".concat(e)},editChannelName:function(e,n){if(e)return"/discourse-presence/edit/".concat(n)},_setupChannel:function(e,n){var t,r;(null===(t=this[e])||void 0===t?void 0:t.name)!==n&&(null===(r=this[e])||void 0===r||r.unsubscribe(),n?(this.set(e,this.presence.getChannel(n)),this[e].subscribe()):this[e]&&this.set(e,null))},_setupChannels:function(){this._setupChannel("replyChannel",this.replyChannelName),this._setupChannel("whisperChannel",this.whisperChannelName),this._setupChannel("editChannel",this.editChannelName)},_cleanupChannels:function(){this._setupChannel("replyChannel",null),this._setupChannel("whisperChannel",null),this._setupChannel("editChannel",null)},replyingUsers:(0,t.union)("replyChannel.users","whisperChannel.users"),editingUsers:(0,t.readOnly)("editChannel.users"),presenceUsers:function(e,n,t){var r,s=this,i=e?n:t;return null==i?void 0:null===(r=i.filter(function(e){return e.id!==s.currentUser.id}))||void 0===r?void 0:r.slice(0,this.siteSettings.presence_max_users_shown)},shouldDisplay:(0,t.gt)("presenceUsers.length",0),subscribe:function(){this._setupChannels()},_contentChanged:function(){var e,n;if(""!==this.model.reply){var t="edit"===this.state?null===(e=this.model)||void 0===e?void 0:e.post:null===(n=this.model)||void 0===n?void 0:n.topic;this.composerPresenceManager.notifyState(this.state,null==t?void 0:t.id)}},closeComposer:function(){this._cleanupChannels(),this.composerPresenceManager.leave()}},"state",[l],Object.getOwnPropertyDescriptor(m,"state"),m),i(m,"replyChannelName",[a],Object.getOwnPropertyDescriptor(m,"replyChannelName"),m),i(m,"whisperChannelName",[o],Object.getOwnPropertyDescriptor(m,"whisperChannelName"),m),i(m,"editChannelName",[c],Object.getOwnPropertyDescriptor(m,"editChannelName"),m),i(m,"_setupChannels",[u],Object.getOwnPropertyDescriptor(m,"_setupChannels"),m),i(m,"presenceUsers",[p],Object.getOwnPropertyDescriptor(m,"presenceUsers"),m),i(m,"subscribe",[d],Object.getOwnPropertyDescriptor(m,"subscribe"),m),i(m,"_contentChanged",[h],Object.getOwnPropertyDescriptor(m,"_contentChanged"),m),i(m,"closeComposer",[f],Object.getOwnPropertyDescriptor(m,"closeComposer"),m),m));e["default"]=y}),define("discourse/plugins/discourse-presence/discourse/components/topic-presence-display",["exports","discourse-common/utils/decorators","@ember/component","@ember/object/computed","@ember/service"],function(e,n,t,r,s){"use strict";function i(e,n,t,r,s){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,r){return r(e,n,t)||t},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=undefined),void 0===i.initializer&&(Object.defineProperty(e,n,i),i=null),i}var l,a,o,c,u,p;Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var d=t["default"].extend((l=(0,n["default"])("replyChannel.users.[]"),a=(0,n["default"])("whisperChannel.users.[]"),o=(0,n["default"])("topic.id"),c=(0,n["default"])("topic.id"),u=(0,n.on)("willDestroyElement"),i(p={topic:null,presence:(0,s.inject)(),replyChannel:null,whisperChannel:null,replyUsers:function(e){var n=this;return null==e?void 0:e.filter(function(e){return e.id!==n.currentUser.id})},whisperUsers:function(e){var n=this;return null==e?void 0:e.filter(function(e){return e.id!==n.currentUser.id})},users:(0,r.union)("replyUsers","whisperUsers"),replyChannelName:function(e){return"/discourse-presence/reply/".concat(e)},whisperChannelName:function(e){return"/discourse-presence/whisper/".concat(e)},shouldDisplay:(0,r.gt)("users.length",0),didReceiveAttrs:function(){var e,n,t,r;(this._super.apply(this,arguments),(null===(e=this.replyChannel)||void 0===e?void 0:e.name)!==this.replyChannelName)&&(null===(t=this.replyChannel)||void 0===t||t.unsubscribe(),this.set("replyChannel",this.presence.getChannel(this.replyChannelName)),this.replyChannel.subscribe());this.currentUser.staff&&(null===(n=this.whisperChannel)||void 0===n?void 0:n.name)!==this.whisperChannelName&&(null===(r=this.whisperChannel)||void 0===r||r.unsubscribe(),this.set("whisperChannel",this.presence.getChannel(this.whisperChannelName)),this.whisperChannel.subscribe())},_destroyed:function(){var e,n;null===(e=this.replyChannel)||void 0===e||e.unsubscribe(),null===(n=this.whisperChannel)||void 0===n||n.unsubscribe()}},"replyUsers",[l],Object.getOwnPropertyDescriptor(p,"replyUsers"),p),i(p,"whisperUsers",[a],Object.getOwnPropertyDescriptor(p,"whisperUsers"),p),i(p,"replyChannelName",[o],Object.getOwnPropertyDescriptor(p,"replyChannelName"),p),i(p,"whisperChannelName",[c],Object.getOwnPropertyDescriptor(p,"whisperChannelName"),p),i(p,"_destroyed",[u],Object.getOwnPropertyDescriptor(p,"_destroyed"),p),p));e["default"]=d}),define("discourse/plugins/discourse-presence/discourse/services/composer-presence-manager",["exports","@ember/service","@ember/runloop","discourse-common/config/environment"],function(e,n,t,r){"use strict";function s(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n}function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,n,t,r){t&&Object.defineProperty(e,n,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(r):void 0})}function a(e,n){if(!s(e,n))throw new TypeError("Cannot call a class as a function")}function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}function u(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&p(e,n)}function p(e,n){return(p=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function d(e){var n=m();return function(){var t,r=y(e);if(n){var s=y(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return h(this,t)}}function h(e,n){return!n||"object"!==i(n)&&"function"!=typeof n?f(e):n}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,n,t,r,s){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,r){return r(e,n,t)||t},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=undefined),void 0===i.initializer&&(Object.defineProperty(e,n,i),i=null),i}var v,C;Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var w="/discourse-presence",g=10,_=(C=b((v=function(){function e(){var n;a(this,e);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return l(f(n=s.call.apply(s,[this].concat(r))),"presence",C,f(n)),n}u(e,n["default"]);var s=d(e);return c(e,[{key:"notifyState",value:function(e,n){if(!this.siteSettings.allow_users_to_hide_profile||!this.currentUser.hide_profile_and_presence){if(e===undefined)return this.leave();if(!["reply","whisper","edit"].includes(e))throw"Unknown intent ".concat(e);var s="".concat(e,"/").concat(n);this._state!==s&&(this._enter(e,n),this._state=s),(0,r.isTesting)()||(this._autoLeaveTimer=(0,t.debounce)(this,this.leave,1e3*g))}}},{key:"leave",value:function(){var e;null===(e=this._presentChannel)||void 0===e||e.leave(),this._presentChannel=null,this._state=null,this._autoLeaveTimer&&((0,t.cancel)(this._autoLeaveTimer),this._autoLeaveTimer=null)}},{key:"_enter",value:function(e,n){this.leave();var t="".concat(w,"/").concat(e,"/").concat(n);this._presentChannel=this.presence.getChannel(t),this._presentChannel.enter()}},{key:"willDestroy",value:function(){this.leave()}}]),e}()).prototype,"presence",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v);e["default"]=_}),Ember.TEMPLATES["javascripts/components/composer-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[24,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","presence-users"],[8],[0,"\\n    "],[7,"div",true],[10,"class","presence-avatars"],[8],[0,"\\n"],[4,"each",[[24,["presenceUsers"]]],null,{"statements":[[0,"        "],[1,[28,"avatar",[[23,1,[]]],[["imageSize"],["small"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","presence-text"],[8],[0,"\\n      "],[7,"span",true],[10,"class","description"],[8],[0,"\\n"],[4,"if",[[24,["isReply"]]],null,{"statements":[[1,[28,"i18n",["presence.replying"],[["count"],[[24,["presenceUsers","length"]]]]],false]],"parameters":[]},{"statements":[[1,[28,"i18n",["presence.editing"],[["count"],[[24,["presenceUsers","length"]]]]],false]],"parameters":[]}],[1,"",false],[9],[1,"",false],[7,"span",true],[10,"class","wave"],[8],[1,"",false],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[1,"",false],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/composer-presence-display"}}),Ember.TEMPLATES["javascripts/components/topic-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[24,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","presence-users"],[8],[0,"\\n    "],[7,"div",true],[10,"class","presence-avatars"],[8],[0,"\\n"],[4,"each",[[24,["users"]]],null,{"statements":[[4,"user-link",null,[["user"],[[23,1,[]]]],{"statements":[[0,"          "],[1,[28,"avatar",[[23,1,[]]],[["imageSize"],["small"]]],false],[0,"\\n"]],"parameters":[]},null]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","presence-text"],[8],[0,"\\n      "],[7,"span",true],[10,"class","description"],[8],[1,[28,"i18n",["presence.replying_to_topic"],[["count"],[[24,["users","length"]]]]],false],[9],[7,"span",true],[10,"class","wave"],[8],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/topic-presence-display"}}),Ember.TEMPLATES["javascripts/connectors/before-composer-controls/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"composer-presence-display",null,[["model"],[[24,["model"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/before-composer-controls/presence"}}),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"topic-presence-display",null,[["topic"],[[24,["model"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/topic-above-footer-buttons/presence"}});
//# sourceMappingURL=/assets/plugins/discourse-presence-bc826a395189b32e4676ad0c4414f821f9bab8245747789b6d555fc16581dacd.js.map